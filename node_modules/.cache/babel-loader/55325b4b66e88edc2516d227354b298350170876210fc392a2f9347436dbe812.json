{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import'../styles/Ascii.css';import loadingGif from'../videos/loading2.gif';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const ASCIIAnimation=_ref=>{var _videoRef$current,_videoRef$current2;let{videoPath,fps,charsWidth,color}=_ref;const videoRef=useRef(null);const asciiRef=useRef(null);const pixels=\"@%#*+=-:;~<>^()_{}|\\\\/?,.`\\\"\";const[frames,setFrames]=useState([]);const[loading,setLoading]=useState(true);// Track loading state\nconst[processedFrames,setProcessedFrames]=useState(0);// Track the number of processed frames\nconst[fadeIn,setFadeIn]=useState(false);// Track whether to fade in the ASCII animation\nconst generateAsciiFrames=useCallback(async()=>{const video=videoRef.current;let localFrames=[];const canvas=document.createElement('canvas');const context=canvas.getContext('2d',{willReadFrequently:true});const frameInterval=1/fps;const totalFrames=Math.ceil(video.duration*fps);for(let i=0;i<totalFrames;i++){const currentTime=i*frameInterval;video.currentTime=currentTime;await new Promise(resolve=>{video.onseeked=()=>{video.pause();resolve();};});const asciiWidth=charsWidth;const aspectRatio=video.videoWidth/video.videoHeight;const asciiHeight=Math.floor(asciiWidth/(2*aspectRatio));canvas.width=asciiWidth;canvas.height=asciiHeight;console.log(\"canvas width = \"+canvas.width);console.log(\"canvas height = \"+canvas.height);context.drawImage(video,0,0,canvas.width,canvas.height);const imgData=context.getImageData(0,0,canvas.width,canvas.height);let asciiString='';for(let y=0;y<canvas.height;y++){for(let x=0;x<canvas.width;x++){const index=4*(y*canvas.width+x);const[r,g,b]=imgData.data.slice(index,index+3);const gray=Math.round(0.299*r+0.587*g+0.114*b);const char=pixels[Math.floor(gray/255*(pixels.length-1))];asciiString+=char;}asciiString+='\\n';}localFrames.push(asciiString);setProcessedFrames(i+1);// Update the number of processed frames\n}setFrames(localFrames);setLoading(false);// Set loading to false when frames are loaded\nsetFadeIn(true);// Trigger fade in animation\n},[charsWidth,fps,pixels]);const generateCharsAnimation=useCallback(()=>{let currentFrame=0;const totalFrames=frames.length;const animate=()=>{if(totalFrames>0){asciiRef.current.innerText=frames[currentFrame];currentFrame=(currentFrame+1)%totalFrames;setTimeout(animate,1000/fps);}};animate();},[frames,fps]);useEffect(()=>{const video=videoRef.current;const handleVideoLoad=()=>{generateAsciiFrames().catch(error=>console.error('Error generating ASCII frames:',error));};video.addEventListener('loadeddata',handleVideoLoad);return()=>{video.removeEventListener('loadeddata',handleVideoLoad);};},[generateAsciiFrames]);useEffect(()=>{if(frames.length>0){generateCharsAnimation();}},[frames,generateCharsAnimation]);return/*#__PURE__*/_jsxs(\"div\",{children:[loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading\",children:[/*#__PURE__*/_jsx(\"img\",{src:loadingGif,alt:\"Loading...\"}),Math.ceil(((_videoRef$current=videoRef.current)===null||_videoRef$current===void 0?void 0:_videoRef$current.duration)*fps)?/*#__PURE__*/_jsxs(\"p\",{children:[\"Processing Frames: \",processedFrames,\"/\",Math.ceil(((_videoRef$current2=videoRef.current)===null||_videoRef$current2===void 0?void 0:_videoRef$current2.duration)*fps)]}):/*#__PURE__*/_jsx(\"p\",{})]})// Display loading icon while frames are loading\n:/*#__PURE__*/_jsx(\"pre\",{ref:asciiRef,className:\"ascii-body\"}),/*#__PURE__*/_jsx(\"video\",{ref:videoRef,src:videoPath,crossOrigin:\"anonymous\",style:{display:'none'}})]});};export default ASCIIAnimation;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","loadingGif","jsx","_jsx","jsxs","_jsxs","ASCIIAnimation","_ref","_videoRef$current","_videoRef$current2","videoPath","fps","charsWidth","color","videoRef","asciiRef","pixels","frames","setFrames","loading","setLoading","processedFrames","setProcessedFrames","fadeIn","setFadeIn","generateAsciiFrames","video","current","localFrames","canvas","document","createElement","context","getContext","willReadFrequently","frameInterval","totalFrames","Math","ceil","duration","i","currentTime","Promise","resolve","onseeked","pause","asciiWidth","aspectRatio","videoWidth","videoHeight","asciiHeight","floor","width","height","console","log","drawImage","imgData","getImageData","asciiString","y","x","index","r","g","b","data","slice","gray","round","char","length","push","generateCharsAnimation","currentFrame","animate","innerText","setTimeout","handleVideoLoad","catch","error","addEventListener","removeEventListener","children","className","src","alt","ref","crossOrigin","style","display"],"sources":["C:/Users/Dahlia/Documents/dahliaxie.github.io/src/components/ASCIIAnimation.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport '../styles/Ascii.css';\r\nimport loadingGif from '../videos/loading2.gif';\r\n\r\nconst ASCIIAnimation = ({ videoPath, fps, charsWidth, color }) => {\r\n  const videoRef = useRef(null);\r\n  const asciiRef = useRef(null);\r\n  const pixels = \"@%#*+=-:;~<>^()_{}|\\\\/?,.`\\\"\";\r\n  const [frames, setFrames] = useState([]);\r\n  const [loading, setLoading] = useState(true); // Track loading state\r\n  const [processedFrames, setProcessedFrames] = useState(0); // Track the number of processed frames\r\n  const [fadeIn, setFadeIn] = useState(false); // Track whether to fade in the ASCII animation\r\n\r\n  const generateAsciiFrames = useCallback(async () => {\r\n    const video = videoRef.current;\r\n    let localFrames = [];\r\n    const canvas = document.createElement('canvas');\r\n    const context = canvas.getContext('2d', { willReadFrequently: true });\r\n    const frameInterval = 1 / fps;\r\n    const totalFrames = Math.ceil(video.duration * fps);\r\n\r\n    for (let i = 0; i < totalFrames; i++) {\r\n      const currentTime = i * frameInterval;\r\n      video.currentTime = currentTime;\r\n\r\n      await new Promise(resolve => {\r\n        video.onseeked = () => {\r\n          video.pause();\r\n          resolve();\r\n        };\r\n      });\r\n\r\n      const asciiWidth = charsWidth;\r\n      const aspectRatio = video.videoWidth / video.videoHeight;\r\n      const asciiHeight = Math.floor(asciiWidth / (2 * aspectRatio));\r\n\r\n      canvas.width = asciiWidth;\r\n      canvas.height = asciiHeight;\r\n      console.log(\"canvas width = \"+ canvas.width);\r\n      console.log(\"canvas height = \"+canvas.height);\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n      const imgData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n      let asciiString = '';\r\n\r\n      for (let y = 0; y < canvas.height; y++) {\r\n        for (let x = 0; x < canvas.width; x++) {\r\n          const index = 4 * (y * canvas.width + x);\r\n          const [r, g, b] = imgData.data.slice(index, index + 3);\r\n          const gray = Math.round(0.299 * r + 0.587 * g + 0.114 * b);\r\n          const char = pixels[Math.floor((gray / 255) * (pixels.length - 1))];\r\n          asciiString += char;\r\n        }\r\n        asciiString += '\\n';\r\n      }\r\n\r\n      localFrames.push(asciiString);\r\n      setProcessedFrames(i + 1); // Update the number of processed frames\r\n    }\r\n\r\n    setFrames(localFrames);\r\n    setLoading(false); // Set loading to false when frames are loaded\r\n    setFadeIn(true); // Trigger fade in animation\r\n  }, [charsWidth, fps, pixels]);\r\n\r\n  const generateCharsAnimation = useCallback(() => {\r\n    let currentFrame = 0;\r\n    const totalFrames = frames.length;\r\n\r\n    const animate = () => {\r\n      if (totalFrames > 0) {\r\n        asciiRef.current.innerText = frames[currentFrame];\r\n        currentFrame = (currentFrame + 1) % totalFrames;\r\n        setTimeout(animate, 1000 / fps);\r\n      }\r\n    };\r\n\r\n    animate();\r\n  }, [frames, fps]);\r\n\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n\r\n    const handleVideoLoad = () => {\r\n      generateAsciiFrames().catch(error => console.error('Error generating ASCII frames:', error));\r\n    };\r\n\r\n    video.addEventListener('loadeddata', handleVideoLoad);\r\n\r\n    return () => {\r\n      video.removeEventListener('loadeddata', handleVideoLoad);\r\n    };\r\n  }, [generateAsciiFrames]);\r\n\r\n  useEffect(() => {\r\n    if (frames.length > 0) {\r\n      generateCharsAnimation();\r\n    }\r\n  }, [frames, generateCharsAnimation]);\r\n\r\n  return (\r\n    <div>\r\n      {loading ? (\r\n        <div className=\"loading\">\r\n          <img src={loadingGif} alt=\"Loading...\" />\r\n          {Math.ceil(videoRef.current?.duration * fps) ? (\r\n            <p>Processing Frames: {processedFrames}/{Math.ceil(videoRef.current?.duration * fps)}</p>\r\n          ) : (<p></p>)}\r\n        </div> // Display loading icon while frames are loading\r\n      ) : (\r\n        <pre ref={asciiRef} className=\"ascii-body\" />\r\n      )}\r\n      <video ref={videoRef} src={videoPath} crossOrigin=\"anonymous\" style={{ display: 'none' }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ASCIIAnimation;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACvE,MAAO,qBAAqB,CAC5B,MAAO,CAAAC,UAAU,KAAM,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEhD,KAAM,CAAAC,cAAc,CAAGC,IAAA,EAA2C,KAAAC,iBAAA,CAAAC,kBAAA,IAA1C,CAAEC,SAAS,CAAEC,GAAG,CAAEC,UAAU,CAAEC,KAAM,CAAC,CAAAN,IAAA,CAC3D,KAAM,CAAAO,QAAQ,CAAGhB,MAAM,CAAC,IAAI,CAAC,CAC7B,KAAM,CAAAiB,QAAQ,CAAGjB,MAAM,CAAC,IAAI,CAAC,CAC7B,KAAM,CAAAkB,MAAM,CAAG,8BAA8B,CAC7C,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGnB,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACoB,OAAO,CAAEC,UAAU,CAAC,CAAGrB,QAAQ,CAAC,IAAI,CAAC,CAAE;AAC9C,KAAM,CAACsB,eAAe,CAAEC,kBAAkB,CAAC,CAAGvB,QAAQ,CAAC,CAAC,CAAC,CAAE;AAC3D,KAAM,CAACwB,MAAM,CAAEC,SAAS,CAAC,CAAGzB,QAAQ,CAAC,KAAK,CAAC,CAAE;AAE7C,KAAM,CAAA0B,mBAAmB,CAAGzB,WAAW,CAAC,SAAY,CAClD,KAAM,CAAA0B,KAAK,CAAGZ,QAAQ,CAACa,OAAO,CAC9B,GAAI,CAAAC,WAAW,CAAG,EAAE,CACpB,KAAM,CAAAC,MAAM,CAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAC/C,KAAM,CAAAC,OAAO,CAAGH,MAAM,CAACI,UAAU,CAAC,IAAI,CAAE,CAAEC,kBAAkB,CAAE,IAAK,CAAC,CAAC,CACrE,KAAM,CAAAC,aAAa,CAAG,CAAC,CAAGxB,GAAG,CAC7B,KAAM,CAAAyB,WAAW,CAAGC,IAAI,CAACC,IAAI,CAACZ,KAAK,CAACa,QAAQ,CAAG5B,GAAG,CAAC,CAEnD,IAAK,GAAI,CAAA6B,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGJ,WAAW,CAAEI,CAAC,EAAE,CAAE,CACpC,KAAM,CAAAC,WAAW,CAAGD,CAAC,CAAGL,aAAa,CACrCT,KAAK,CAACe,WAAW,CAAGA,WAAW,CAE/B,KAAM,IAAI,CAAAC,OAAO,CAACC,OAAO,EAAI,CAC3BjB,KAAK,CAACkB,QAAQ,CAAG,IAAM,CACrBlB,KAAK,CAACmB,KAAK,CAAC,CAAC,CACbF,OAAO,CAAC,CAAC,CACX,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAAG,UAAU,CAAGlC,UAAU,CAC7B,KAAM,CAAAmC,WAAW,CAAGrB,KAAK,CAACsB,UAAU,CAAGtB,KAAK,CAACuB,WAAW,CACxD,KAAM,CAAAC,WAAW,CAAGb,IAAI,CAACc,KAAK,CAACL,UAAU,EAAI,CAAC,CAAGC,WAAW,CAAC,CAAC,CAE9DlB,MAAM,CAACuB,KAAK,CAAGN,UAAU,CACzBjB,MAAM,CAACwB,MAAM,CAAGH,WAAW,CAC3BI,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAE1B,MAAM,CAACuB,KAAK,CAAC,CAC5CE,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC1B,MAAM,CAACwB,MAAM,CAAC,CAC7CrB,OAAO,CAACwB,SAAS,CAAC9B,KAAK,CAAE,CAAC,CAAE,CAAC,CAAEG,MAAM,CAACuB,KAAK,CAAEvB,MAAM,CAACwB,MAAM,CAAC,CAC3D,KAAM,CAAAI,OAAO,CAAGzB,OAAO,CAAC0B,YAAY,CAAC,CAAC,CAAE,CAAC,CAAE7B,MAAM,CAACuB,KAAK,CAAEvB,MAAM,CAACwB,MAAM,CAAC,CACvE,GAAI,CAAAM,WAAW,CAAG,EAAE,CAEpB,IAAK,GAAI,CAAAC,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG/B,MAAM,CAACwB,MAAM,CAAEO,CAAC,EAAE,CAAE,CACtC,IAAK,GAAI,CAAAC,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGhC,MAAM,CAACuB,KAAK,CAAES,CAAC,EAAE,CAAE,CACrC,KAAM,CAAAC,KAAK,CAAG,CAAC,EAAIF,CAAC,CAAG/B,MAAM,CAACuB,KAAK,CAAGS,CAAC,CAAC,CACxC,KAAM,CAACE,CAAC,CAAEC,CAAC,CAAEC,CAAC,CAAC,CAAGR,OAAO,CAACS,IAAI,CAACC,KAAK,CAACL,KAAK,CAAEA,KAAK,CAAG,CAAC,CAAC,CACtD,KAAM,CAAAM,IAAI,CAAG/B,IAAI,CAACgC,KAAK,CAAC,KAAK,CAAGN,CAAC,CAAG,KAAK,CAAGC,CAAC,CAAG,KAAK,CAAGC,CAAC,CAAC,CAC1D,KAAM,CAAAK,IAAI,CAAGtD,MAAM,CAACqB,IAAI,CAACc,KAAK,CAAEiB,IAAI,CAAG,GAAG,EAAKpD,MAAM,CAACuD,MAAM,CAAG,CAAC,CAAC,CAAC,CAAC,CACnEZ,WAAW,EAAIW,IAAI,CACrB,CACAX,WAAW,EAAI,IAAI,CACrB,CAEA/B,WAAW,CAAC4C,IAAI,CAACb,WAAW,CAAC,CAC7BrC,kBAAkB,CAACkB,CAAC,CAAG,CAAC,CAAC,CAAE;AAC7B,CAEAtB,SAAS,CAACU,WAAW,CAAC,CACtBR,UAAU,CAAC,KAAK,CAAC,CAAE;AACnBI,SAAS,CAAC,IAAI,CAAC,CAAE;AACnB,CAAC,CAAE,CAACZ,UAAU,CAAED,GAAG,CAAEK,MAAM,CAAC,CAAC,CAE7B,KAAM,CAAAyD,sBAAsB,CAAGzE,WAAW,CAAC,IAAM,CAC/C,GAAI,CAAA0E,YAAY,CAAG,CAAC,CACpB,KAAM,CAAAtC,WAAW,CAAGnB,MAAM,CAACsD,MAAM,CAEjC,KAAM,CAAAI,OAAO,CAAGA,CAAA,GAAM,CACpB,GAAIvC,WAAW,CAAG,CAAC,CAAE,CACnBrB,QAAQ,CAACY,OAAO,CAACiD,SAAS,CAAG3D,MAAM,CAACyD,YAAY,CAAC,CACjDA,YAAY,CAAG,CAACA,YAAY,CAAG,CAAC,EAAItC,WAAW,CAC/CyC,UAAU,CAACF,OAAO,CAAE,IAAI,CAAGhE,GAAG,CAAC,CACjC,CACF,CAAC,CAEDgE,OAAO,CAAC,CAAC,CACX,CAAC,CAAE,CAAC1D,MAAM,CAAEN,GAAG,CAAC,CAAC,CAEjBd,SAAS,CAAC,IAAM,CACd,KAAM,CAAA6B,KAAK,CAAGZ,QAAQ,CAACa,OAAO,CAE9B,KAAM,CAAAmD,eAAe,CAAGA,CAAA,GAAM,CAC5BrD,mBAAmB,CAAC,CAAC,CAACsD,KAAK,CAACC,KAAK,EAAI1B,OAAO,CAAC0B,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CAAC,CAC9F,CAAC,CAEDtD,KAAK,CAACuD,gBAAgB,CAAC,YAAY,CAAEH,eAAe,CAAC,CAErD,MAAO,IAAM,CACXpD,KAAK,CAACwD,mBAAmB,CAAC,YAAY,CAAEJ,eAAe,CAAC,CAC1D,CAAC,CACH,CAAC,CAAE,CAACrD,mBAAmB,CAAC,CAAC,CAEzB5B,SAAS,CAAC,IAAM,CACd,GAAIoB,MAAM,CAACsD,MAAM,CAAG,CAAC,CAAE,CACrBE,sBAAsB,CAAC,CAAC,CAC1B,CACF,CAAC,CAAE,CAACxD,MAAM,CAAEwD,sBAAsB,CAAC,CAAC,CAEpC,mBACEpE,KAAA,QAAA8E,QAAA,EACGhE,OAAO,cACNd,KAAA,QAAK+E,SAAS,CAAC,SAAS,CAAAD,QAAA,eACtBhF,IAAA,QAAKkF,GAAG,CAAEpF,UAAW,CAACqF,GAAG,CAAC,YAAY,CAAE,CAAC,CACxCjD,IAAI,CAACC,IAAI,CAAC,EAAA9B,iBAAA,CAAAM,QAAQ,CAACa,OAAO,UAAAnB,iBAAA,iBAAhBA,iBAAA,CAAkB+B,QAAQ,EAAG5B,GAAG,CAAC,cAC1CN,KAAA,MAAA8E,QAAA,EAAG,qBAAmB,CAAC9D,eAAe,CAAC,GAAC,CAACgB,IAAI,CAACC,IAAI,CAAC,EAAA7B,kBAAA,CAAAK,QAAQ,CAACa,OAAO,UAAAlB,kBAAA,iBAAhBA,kBAAA,CAAkB8B,QAAQ,EAAG5B,GAAG,CAAC,EAAI,CAAC,cACtFR,IAAA,OAAM,CAAE,EACV,CAAE;AAAA,cAEPA,IAAA,QAAKoF,GAAG,CAAExE,QAAS,CAACqE,SAAS,CAAC,YAAY,CAAE,CAC7C,cACDjF,IAAA,UAAOoF,GAAG,CAAEzE,QAAS,CAACuE,GAAG,CAAE3E,SAAU,CAAC8E,WAAW,CAAC,WAAW,CAACC,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAO,CAAE,CAAE,CAAC,EACzF,CAAC,CAEV,CAAC,CAED,cAAe,CAAApF,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}